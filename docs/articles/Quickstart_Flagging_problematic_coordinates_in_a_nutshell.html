<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick start - Flagging problematic coordinates in a nutshell • CoordinateCleaner</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quick start - Flagging problematic coordinates in a nutshell">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CoordinateCleaner</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Background_comparison_other_software.html">Background - Comparison of CoordinateCleaner to other tools</a>
    </li>
    <li>
      <a href="../articles/Background_dataset_level_cleaning.html">Background - Dataset-level cleaning</a>
    </li>
    <li>
      <a href="../articles/Background_the_institutions_database.html">Background - The institutions database</a>
    </li>
    <li>
      <a href="../articles/Quickstart_clean_fossils.html">Quick start - Problematic fossils</a>
    </li>
    <li>
      <a href="../articles/Quickstart_Flagging_problematic_coordinates_in_a_nutshell.html">Quick start - Flagging problematic coordinates in a nutshell</a>
    </li>
    <li>
      <a href="../articles/Tutorial_Cleaning_GBIF_data_with_CoordinateCleaner.html">Tutorial - Cleaning GBIF data for the use in biogeography</a>
    </li>
    <li>
      <a href="../articles/Tutorial_Cleaning_PBDB_fossils_with_CoordinateCleaner.html">Tutorial - Cleaning fossil data for the use in biogeography and palaeontology</a>
    </li>
    <li>
      <a href="../articles/Tutorial_geographic_outliers.html">Tutorial - Identifying geographic outliers</a>
    </li>
    <li>
      <a href="../articles/Tutorial_Using_custom_gazetteers.html">Tutorial - Using customized gazetteers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Quick start - Flagging problematic coordinates in a nutshell</h1>
            
      
      
      <div class="hidden name"><code>Quickstart_Flagging_problematic_coordinates_in_a_nutshell.Rmd</code></div>

    </div>

    
    
<p>The <code>clean_coordinates</code> function enables a fast, automated and reproducible flagging of potentially erroneous occurrence coordinates based on geographic gazetteers. The function flags records based on known problems common to biological and palaeontological collection databases.</p>
<p>Individual tests can be switched on and off by a logical flag (see <code><a href="../reference/clean_coordinates.html">?clean_coordinates</a></code>) and distance thresholds for all tests can be adapted. Custom gazetteers can be provided for all tests (for instance for a higher level of detail). See here for a detailed tutorial on how to clean occurrence records using <code>CoordinateCleaner</code>.</p>
<p><strong><em>Please find a detailed tutorial on how to clean occurrence records (e.g. from GBIF) <a href="https://ropensci.github.io/CoordinateCleaner/articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">here</a> and how to clean fossil data (e.g. from PBDB) <a href="https://ropensci.github.io/CoordinateCleaner/articles/Cleaning_PBDB_fossils_with_CoordinateCleaner.html">here</a>.</em></strong></p>
<div id="switch-individual-test-onoff" class="section level2">
<h2 class="hasAnchor">
<a href="#switch-individual-test-onoff" class="anchor"></a>Switch individual test on/off</h2>
<p><code>clean_coordinates</code> wraps around multiple tests for common error sources in species distribution records. Individual test can be included or excluded from a run with the tests argument of <code>clean_coordinates</code>, e.g. <code>"seas"</code> switches the seas test off. Most basic tests are switched on by defaults.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(CoordinateCleaner)
<span class="kw">library</span>(dplyr)

exmpl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">species =</span> <span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">250</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">decimallongitude =</span> <span class="kw">runif</span>(<span class="dv">250</span>, 
    <span class="dt">min =</span> <span class="dv">42</span>, <span class="dt">max =</span> <span class="dv">51</span>), <span class="dt">decimallatitude =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="dt">min =</span> <span class="op">-</span><span class="dv">26</span>, <span class="dt">max =</span> <span class="op">-</span><span class="dv">11</span>), 
    <span class="dt">countries =</span> <span class="st">"MDG"</span>)


<span class="co"># run all tests</span>
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_coordinates.html">clean_coordinates</a></span>(exmpl, <span class="dt">tests =</span> <span class="kw">c</span>(<span class="st">"capitals"</span>, <span class="st">"centroids"</span>, <span class="st">"countries"</span>, 
    <span class="st">"equal"</span>, <span class="st">"gbif"</span>, <span class="st">"institutions"</span>, <span class="st">"outliers"</span>, <span class="st">"seas"</span>, <span class="st">"urban"</span>, <span class="st">"zeros"</span>), 
    <span class="dt">countries =</span> <span class="st">"countries"</span>)
## OGR data source with driver: ESRI Shapefile 
## Source: "C:\Users\alexander.zizka\Documents\R\win-library\3.6\CoordinateCleaner\sea.EXT", layer: "ne_50m_land"
## with 1420 features
## It has 3 fields
## Integer64 fields read as strings:  scalerank 
## OGR data source with driver: ESRI Shapefile 
## Source: "C:\Users\alexander.zizka\Documents\R\win-library\3.6\CoordinateCleaner\urb.EXT", layer: "ne_50m_urban_areas"
## with 2143 features
## It has 4 fields
## Integer64 fields read as strings:  scalerank

<span class="co"># only run the validity test</span>
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_coordinates.html">clean_coordinates</a></span>(exmpl, <span class="dt">tests =</span> <span class="kw">c</span>(<span class="st">""</span>))</code></pre></div>
<table style="width:22%;" class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th>Test</th>
<th>Function</th>
<th>Background</th>
<th>Default</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>capitals</td>
<td>radius around capitals</td>
<td>georeferenced from location description</td>
<td>on</td>
</tr>
<tr class="even">
<td>centroids</td>
<td>radius around country and province centroids</td>
<td>geo-referenced from description</td>
<td>on</td>
</tr>
<tr class="odd">
<td>countries</td>
<td>coordinates in the right country</td>
<td>switched lon/lat, data entry errors</td>
<td>off</td>
</tr>
<tr class="even">
<td>duplicates</td>
<td>records from one species with identical coordinates</td>
<td>repetitive observation of identical individual, same voucher from multiple data sources, genetic data</td>
<td>off</td>
</tr>
<tr class="odd">
<td>gbif</td>
<td>radius around GBIF headquarters</td>
<td>data entry errors, falsely geo-referenced</td>
<td>on</td>
</tr>
<tr class="even">
<td>institutions</td>
<td>radius around biodiversity institutions</td>
<td>falsely geo-referenced, zoo or garden records</td>
<td>on</td>
</tr>
<tr class="odd">
<td>iucn</td>
<td>records outside the natural range, or any custom polygon</td>
<td>off</td>
<td></td>
</tr>
<tr class="even">
<td>outliers</td>
<td>records far away from all other records of this species</td>
<td>various</td>
<td>off</td>
</tr>
<tr class="odd">
<td>seas</td>
<td>in the sea</td>
<td>switched lon/lat</td>
<td>on</td>
</tr>
<tr class="even">
<td>urban</td>
<td>within urban area</td>
<td>cultivated/captivity</td>
<td>off</td>
</tr>
<tr class="odd">
<td>validity</td>
<td>outside reference coordinate system</td>
<td>missing data, data entry errors</td>
<td>on</td>
</tr>
<tr class="even">
<td>zeros</td>
<td>plain zeros, lat = lon</td>
<td>missing data, data entry errors</td>
<td>on</td>
</tr>
</tbody>
</table>
</div>
<div id="custom-test-radii-for-capitals-centroids-and-institutions" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-test-radii-for-capitals-centroids-and-institutions" class="anchor"></a>Custom test radii for <code>capitals</code>, <code>centroids</code> and <code>institutions</code>
</h2>
<p>The <code>capitals</code>, <code>centroids</code> and <code>institutions</code> test use a radius around gazetteers to flag coordinates. You can change this radius for each test using the <code>*.rad</code> arguments. The radius is specified in meters. If you want to specify it in degrees rather, use the individual <code>cc_*</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/clean_coordinates.html">clean_coordinates</a></span>(exmpl, <span class="dt">capitals_rad =</span> <span class="dv">5000</span>)</code></pre></div>
</div>
<div id="custom-gazetteers" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-gazetteers" class="anchor"></a>Custom gazetteers</h2>
<p>You can use custom gazetteers for all <code>CleanCoordinates</code> tests, via the <code>*.ref</code> arguments of the function. For example the <code>capitals.ref</code> argument controls the reference for the capitals test. Customized reference data must follow the same format as the default reference for the same test. You can check the structure of gazetteers via their documentation or by looking at the gazetteer (e.g. <code>head(capitals)</code>). For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check the format of the default capitals reference</span>
<span class="kw">head</span>(countryref)  <span class="co">#a data.frame with four columns: ISO3, capital, longitude, latitude</span>

<span class="co"># create new reference data set from scratch. For real analysis you probably</span>
<span class="co"># want to load the alternative file from a .txt file</span>
my.cap &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ISO3 =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], <span class="dt">capital =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], <span class="dt">capital.longitude =</span> <span class="kw">runif</span>(<span class="dv">10</span>, 
    <span class="op">-</span><span class="dv">180</span>, <span class="dv">180</span>), <span class="dt">capital.latitude =</span> <span class="kw">runif</span>(<span class="dv">10</span>, <span class="op">-</span><span class="dv">90</span>, <span class="dv">90</span>))

flags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_coordinates.html">clean_coordinates</a></span>(exmpl, <span class="dt">capitals.ref =</span> my.cap)</code></pre></div>
<p>In this way, you can fully customize the tests, and for example provide a gazetteer with the locations of hardware stores (in the capitals format) if you want to flag records around hardware stores.</p>
<p>Classes of the default gazetteers of <code>clean_coordinates</code>.</p>
<table style="width:22%;" class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th>Test</th>
<th>Default gazetteer</th>
<th>Class</th>
<th>Argument</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>capitals</td>
<td>countryref</td>
<td><code>data.frame</code></td>
<td>capitals.ref</td>
</tr>
<tr class="even">
<td>centroids</td>
<td>countryref</td>
<td><code>data.frame</code></td>
<td>centroids.ref</td>
</tr>
<tr class="odd">
<td>countrycheck</td>
<td>rnaturalearth::ne_countries(scale = “medium”)</td>
<td><code>SpatialPolygonsDataFrame</code></td>
<td>country.ref</td>
</tr>
<tr class="even">
<td>institutions</td>
<td>institutions</td>
<td><code>data.frame</code></td>
<td>inst.ref</td>
</tr>
<tr class="odd">
<td>seas</td>
<td>landmass</td>
<td><code>SpatialPolygonsDataFrame</code></td>
<td>seas.ref</td>
</tr>
<tr class="even">
<td>urban</td>
<td>rnaturalearth::ne_download(scale = ‘medium’, type = ‘urban_areas’)</td>
<td><code>SpatialPolygonsDataFrame</code></td>
<td>urban.ref</td>
</tr>
</tbody>
</table>
</div>
<div id="summary-and-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-and-visualization" class="anchor"></a>Summary and visualization</h2>
<p>You cane easily summarize the results of <code>clean_coordinates</code> either with the <code>report</code> option or via <code>summary</code>. If <code>report == T</code> the summary is written to the working directory as a .txt file, if <code>report</code> is a character, it is the path to which the summary file will be written, Alternatively, you can get a summary of the number of records flagged with <code>summary</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># via the report option</span>
flags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clean_coordinates.html">clean_coordinates</a></span>(exmpl)
## OGR data source with driver: ESRI Shapefile 
## Source: "C:\Users\alexander.zizka\Documents\R\win-library\3.6\CoordinateCleaner\sea.EXT", layer: "ne_50m_land"
## with 1420 features
## It has 3 fields
## Integer64 fields read as strings:  scalerank
<span class="co"># flags &lt;- clean_coordinates(exmpl, report = T)</span>

<span class="co"># via summary</span>
<span class="kw">summary</span>(flags)
##     .val     .equ     .zer     .cap     .cen     .sea     .otl     .gbf 
##        0        0        0        0        0      165        0        0 
##    .inst .summary 
##        0      165</code></pre></div>
</div>
<div id="exclude-flagged-records" class="section level1">
<h1 class="hasAnchor">
<a href="#exclude-flagged-records" class="anchor"></a>Exclude flagged records</h1>
<p>The output of <code>clean_coordinates</code> is in the same order as the input, thus you can easily exclude flagged records.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># exclude records flagged by any test</span>
clean &lt;-<span class="st"> </span>exmpl[flags<span class="op">$</span>.summary, ]

<span class="co"># exclude records flagged by the centroids test</span>
clean &lt;-<span class="st"> </span>exmpl[flags<span class="op">$</span>.cen, ]</code></pre></div>
<div id="individual-tests-using-the-pipe" class="section level2">
<h2 class="hasAnchor">
<a href="#individual-tests-using-the-pipe" class="anchor"></a>Individual tests using the pipe</h2>
<p>Alternatively, you can run the individual functions in a pipe compatible way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cleaned &lt;-<span class="st"> </span>exmpl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_val.html">cc_val</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_cap.html">cc_cap</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_cen.html">cc_cen</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_dupl.html">cc_dupl</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_equ.html">cc_equ</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../reference/cc_gbif.html">cc_gbif</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_inst.html">cc_inst</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_outl.html">cc_outl</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_sea.html">cc_sea</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/cc_zero.html">cc_zero</a></span>()
## OGR data source with driver: ESRI Shapefile 
## Source: "C:\Users\alexander.zizka\Documents\R\win-library\3.6\CoordinateCleaner\sea.EXT", layer: "ne_50m_land"
## with 1420 features
## It has 3 fields
## Integer64 fields read as strings:  scalerank</code></pre></div>
<p>In this way, you can also add the individual test results as columns to your intial data.frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exmpl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">val =</span> <span class="kw"><a href="../reference/cc_val.html">cc_val</a></span>(., <span class="dt">value =</span> <span class="st">"flagged"</span>), <span class="dt">sea =</span> <span class="kw"><a href="../reference/cc_sea.html">cc_sea</a></span>(., 
    <span class="dt">value =</span> <span class="st">"flagged"</span>))
## OGR data source with driver: ESRI Shapefile 
## Source: "C:\Users\alexander.zizka\Documents\R\win-library\3.6\CoordinateCleaner\sea.EXT", layer: "ne_50m_land"
## with 1420 features
## It has 3 fields
## Integer64 fields read as strings:  scalerank
## # A tibble: 250 x 6
##    species decimallongitude decimallatitude countries val   sea  
##    &lt;fct&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;fct&gt;     &lt;lgl&gt; &lt;lgl&gt;
##  1 q                   46.1           -15.9 MDG       TRUE  TRUE 
##  2 e                   49.5           -17.0 MDG       TRUE  TRUE 
##  3 t                   42.1           -16.9 MDG       TRUE  FALSE
##  4 b                   47.3           -25.6 MDG       TRUE  FALSE
##  5 j                   43.8           -17.8 MDG       TRUE  FALSE
##  6 f                   50.8           -11.8 MDG       TRUE  FALSE
##  7 x                   50.2           -22.9 MDG       TRUE  FALSE
##  8 v                   42.8           -22.1 MDG       TRUE  FALSE
##  9 u                   50.8           -25.4 MDG       TRUE  FALSE
## 10 c                   48.6           -13.4 MDG       TRUE  FALSE
## # ... with 240 more rows</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#switch-individual-test-onoff">Switch individual test on/off</a></li>
      <li><a href="#custom-test-radii-for-capitals-centroids-and-institutions">Custom test radii for <code>capitals</code>, <code>centroids</code> and <code>institutions</code></a></li>
      <li><a href="#custom-gazetteers">Custom gazetteers</a></li>
      <li><a href="#summary-and-visualization">Summary and visualization</a></li>
      <li>
<a href="#exclude-flagged-records">Exclude flagged records</a><ul class="nav nav-pills nav-stacked">
<li><a href="#individual-tests-using-the-pipe">Individual tests using the pipe</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alexander Zizka.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
